# Chain Anchor

自托管 FISCO BCOS 区块链的外部可验证锚定。

[English](README.en.md)

## 这是什么？

本仓库是我们自托管 FISCO BCOS 区块链的**防篡改时间证明**。我们运营一个单机 4 节点的 FISCO BCOS 网络，用于产品溯源等多项业务的数据存证。由于节点由单一运营方控制，需要外部锚定机制来建立可验证的时间线。

## 工作原理

```
FISCO BCOS (自托管)              外部锚定
┌─────────────────────┐     ┌──────────────────────────┐
│  所有业务数据         │     │  每日 02:00 (UTC+8):     │
│  跨所有应用           │     │                          │
│         │            │     │  1. 获取最新区块          │
│         ▼            │     │  2. 提交 blockHash       │
│  封装在区块中         │────▶│     至 OpenTimestamps    │
│  以 blockHash 链接    │     │  3. 提交至本仓库         │
└─────────────────────┘     └──────────────────────────┘
```

**每日一个 blockHash 锚定整条链**——从创世块到锚定块的所有应用、所有交易，都被这一个哈希隐式承诺。

## 能证明什么，不能证明什么

**能证明：**
- 在某个时间点，链上确实存在这些数据（时间存在性证明）
- 数据未被事后篡改（锚定后的完整性）
- 锚定时间线是连续的（每日记录 + Bitcoin 时间戳）

**不能证明：**
- 链上数据是否反映了真实发生的业务事件
- 运营方在数据上链前是否如实记录

**根本原因：** 当链的所有节点由同一运营方控制时，运营方可以先构造数据、再上链、再锚定，时间线完全成立。这个局限性只能通过引入独立第三方节点来消除。

**当前方案的价值：**
1. **锁定时间线** — 将来引入第三方节点后，历史锚定记录能证明数据不是"事后补的"
2. **提高篡改成本** — 篡改需同时搞定私链 + GitHub 历史 + Bitcoin OTS 记录
3. **透明姿态** — 主动做外部锚定，为将来公开预埋信任基础

## 目录结构

```
anchors/          — 每日锚定记录 (JSON)
  └── YYYY/MM/DD.json
proofs/           — OpenTimestamps 证明文件
  └── YYYY/MM/DD.json.ots
docs/             — GitHub Pages 公开页面
  └── index.html
```

## 锚定记录格式

```json
{
  "blockNumber": 12345,
  "blockHash": "0xabc123...",
  "anchoredAt": "2026-02-16T02:00:00+08:00"
}
```

## 如何验证

### 前置条件

```bash
pip install opentimestamps-client
```

### 第一步：验证 OTS 证明

```bash
ots verify proofs/2026/02/16.json.ots
```

确认 blockHash 在某个 Bitcoin 区块之前已被提交。

### 第二步：比对 blockHash

查询 FISCO BCOS 节点获取对应区块：

```bash
curl http://<webase-url>/WeBASE-Front/1/web3/blockByNumber/<blockNumber>
```

返回的 `hash` 字段应与锚定记录中的 `blockHash` 完全一致。

### 第三步：验证特定交易的存在时间

1. 查找目标交易所在的区块号（通过应用数据库中的 `tx_hash` 或 `block_number`）
2. 确认该区块号 < 锚定区块号
3. 由于区块哈希的链式结构，锚定的 blockHash 承诺了所有之前的区块

**结论：** 该交易可证明存在于 OTS 锚定的 Bitcoin 时间戳之前。

## 信任模型

| 层级 | 信任基础 | 可篡改？ |
|------|---------|---------|
| FISCO BCOS (自托管) | 运营方控制 | 是（单一运营方） |
| 本 GitHub 仓库 | GitHub 提交时间戳 | 理论上可以（需 GitHub 配合） |
| OpenTimestamps → Bitcoin | Bitcoin PoW 共识 | 否（实际不可能） |

三层相互印证。即使某一层被突破，其余两层仍提供独立证据。

**演进路径：** 当引入独立节点加入 FISCO BCOS 网络后，第一层将从"运营方控制"升级为"多方共识"，届时整个信任链条将完全闭合。

## 许可

本仓库及其内容公开，用于透明性和验证目的。
